# ===============================================================================
# APPLICATION PROPERTIES - FIXED CONFIGURATION
# ===============================================================================

# ------------------------------
# Server Configuration
# ------------------------------
server.port=8080
# server.servlet.context-path=/api/v1

# ------------------------------
# PostgreSQL Database Configuration
# ------------------------------
spring.datasource.url=jdbc:postgresql://localhost:5432/metavet
spring.datasource.username=postgres
spring.datasource.password=Faizan@123
spring.datasource.driver-class-name=org.postgresql.Driver

spring.datasource.hikari.maximum-pool-size=20
spring.datasource.hikari.minimum-idle=5
spring.datasource.hikari.connection-timeout=20000
spring.datasource.hikari.idle-timeout=300000   
  
# ------------------------------
# Hibernate / JPA Configuration
# ------------------------------
spring.jpa.hibernate.ddl-auto=update
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.PostgreSQLDialect
spring.jpa.properties.hibernate.format_sql=true
spring.jpa.show-sql=false

spring.jpa.properties.hibernate.jdbc.batch_size=25
spring.jpa.properties.hibernate.order_inserts=true  
spring.jpa.properties.hibernate.order_updates=true
spring.jpa.properties.hibernate.jdbc.batch_versioned_data=true

# ------------------------------
# Security Configuration
# ------------------------------
# REMOVED: These properties were conflicting with JWT security
# spring.autoconfigure.exclude=org.springframework.boot.autoconfigure.security.servlet.SecurityAutoConfiguration
# spring.security.enabled=false
# management.security.enabled=false
# spring.security.csrf.enabled=false

# ------------------------------
# CORS Configuration - REMOVED (Using Java Config Instead)
# ------------------------------
# REMOVED: Spring Boot doesn't auto-configure CORS from these properties
# We're using @Bean CorsConfigurationSource in SecurityConfiguration.java instead
# These properties don't work without a custom WebMvcConfigurer
# spring.web.cors.allowed-origins=http://34.61.254.251
# spring.web.cors.allowed-methods=GET,POST,PUT,DELETE,OPTIONS,PATCH
# spring.web.cors.allowed-headers=Authorization,Content-Type,Accept,Origin,Access-Control-Request-Method,Access-Control-Request-Headers
# spring.web.cors.exposed-headers=Access-Control-Allow-Origin,Access-Control-Allow-Credentials
# spring.web.cors.allow-credentials=true
# spring.web.cors.max-age=3600

# ------------------------------
# Logging Configuration - Enhanced for Debugging
# ------------------------------	
logging.level.root=INFO
logging.level.org.hibernate.SQL=ERROR
logging.level.org.hibernate.type.descriptor.sql.BasicBinder=ERROR
logging.level.org.springframework.security=DEBUG
logging.level.org.springframework.web=DEBUG
logging.level.org.springframework.web.cors=DEBUG
logging.level.com.example.demo=DEBUG

# NEW: Add more detailed logging for CORS debugging
logging.level.org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerMapping=DEBUG
logging.level.org.springframework.security.web.FilterChainProxy=DEBUG

# ------------------------------
# Jackson JSON Configuration
# ------------------------------
spring.jackson.deserialization.fail-on-unknown-properties=false
spring.jackson.serialization.write-dates-as-timestamps=false
spring.jackson.time-zone=Asia/Kolkata
spring.jackson.serialization.fail-on-empty-beans=false

# ------------------------------
# JWT Security Configuration
# ------------------------------
security.jwt.secret-key=bXlBY2Nlc3NTZWNyZXRLZXlGb3JKV1RUb2tlbkdlbmVyYXRpb25BbmRWYWxpZGF0aW9uMjAyNA==
security.jwt.refresh-secret-key=bXlSZWZyZXNoU2VjcmV0S2V5Rm9yUmVmcmVzaFRva2VuR2VuZXJhdGlvbjIwMjQ=
security.jwt.expiration-time=86400000
security.jwt.refresh.expiration-time=604800000

# ------------------------------
# HTTP Response Headers Fix
# ------------------------------
server.error.whitelabel.enabled=false
server.error.include-stacktrace=never
server.error.include-message=always

# ------------------------------
# File Upload Configuration
# ------------------------------
spring.servlet.multipart.max-file-size=10MB
spring.servlet.multipart.max-request-size=10MB

# ------------------------------
# Application Specific Configuration
# ------------------------------
app.otp.expiry-minutes=5
app.otp.length=6
app.pagination.default-page-size=20
app.pagination.max-page-size=100

# ------------------------------
# Session Configuration - Important for JWT
# ------------------------------
server.servlet.session.cookie.http-only=true
server.servlet.session.cookie.secure=false
server.servlet.session.cookie.same-site=lax

# ------------------------------
# Health Check Configuration
# ------------------------------
management.endpoints.web.exposure.include=health,info,metrics
management.endpoint.health.show-details=when-authorized

# ------------------------------
# HTTP Configuration
# ------------------------------
spring.mvc.dispatch-options-request=true

# ------------------------------
# Error Handling Configuration
# ------------------------------
server.error.include-binding-errors=always
server.error.include-exception=false

# ------------------------------
# Environment Specific Overrides
# ------------------------------
spring.profiles.active=dev

# ===============================================================================
# IMPORTANT NOTES:
# ===============================================================================
# 1. CORS is now configured via @Bean in SecurityConfiguration.java
# 2. All spring.web.cors.* properties removed (they don't work without WebMvcConfigurer)
# 3. Security auto-configuration is enabled (required for JWT security)
# 4. Enhanced logging for CORS debugging
# 5. Server runs on port 8080
# 
# CORS ORIGINS ARE CONFIGURED IN CODE:
# - http://35.206.66.49:8282  (Your GCP frontend from error log)
# - http://34.61.254.251      (Your GCP IP from properties)
# - http://localhost:3000     (Local development)
# - http://localhost:4200     (Local Angular development)
# 
# If you need to add more origins, update SecurityConfiguration.java
# ===============================================================================